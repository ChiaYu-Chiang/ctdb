{% extends "base.html" %}
{% load i18n %}
{% block content %}
  <div class="container-fluid">
    <div class="row mb-3">
      <div class="col-md-6">
        <h2>{% trans "行事曆" %}</h2>
      </div>
      <div class="col-md-6 text-right">
        <a href="{% url 'dep_calendar:event_create' %}" class="btn btn-primary">
          <i class="fas fa-plus"></i> {% trans "新增事件" %}
        </a>
      </div>
    </div>
    
    <div class="row">
      <div class="col-12">
        <div id='calendar'></div>
      </div>
    </div>
  </div>

  <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css' rel='stylesheet' />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.8/locales-all.global.min.js'></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const calendarEl = document.getElementById('calendar');
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'zh-tw',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        buttonText: {
          today: '今天',
          month: '月',
          week: '週',
          day: '日'
        },
        events: '{% url "dep_calendar:calendar_events_json" %}',
        eventClick: function(info) {
          // 點擊事件時跳轉到事件詳情頁面
          window.location.href = '/dep_calendar/event/' + info.event.id + '/';
        },
        eventMouseEnter: function(info) {
          // 滑鼠懸停時顯示提示
          info.el.style.cursor = 'pointer';
          info.el.title = '點擊查看事件詳情';
        },
        height: 'auto',
        dayMaxEvents: true, // 當事件太多時顯示 "more" 連結
        moreLinkClick: 'popover'
      });
      calendar.render();
    });
  </script>
{% endblock %}